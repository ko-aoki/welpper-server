<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout">
<head>
    <title>受付</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"
          th:href="@{/webjars/bootstrap/3.2.0/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"
          th:href="@{/webjars/bootstrap/3.2.0/css/bootstrap-theme.min.css}"/>
    <!--
        <script src="https://www.gstatic.com/charts/loader.js"></script>
    -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"
            th:src="@{/webjars/jquery/1.11.1/jquery.min.js}"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"
            th:src="@{/webjars/bootstrap/3.2.0/js/bootstrap.min.js}"></script>
    <style>
        .operating-state-nm {
            height: 100px;
//            background-color: pink;
            font-size: 54px;
            margin-right: 10px;
        }

        .operating-no {
            height: 100px;
//            background-color: skyblue;
            font-size: 54px;
        }

        .btn-receiving-no {
            //background-color: skyblue;
            width: 180px;
            height:100px
        }

        .rest-no-nm {
            height: 60px;
            background-color: darkgray;
            font-size: 32px;
        }

        .rest-no {
            height: 60px;
            background-color: darkgray;
            font-size: 32px;
        }
    </style>
</head>
<body>
<div class="row col-sm-12">
    <div class="col-sm-3" style="margin-top: 20px; font-size: 36px;">
        <label th:text="${reception.sectionNm}">税務課</label>
    </div>
    <div class="col-sm-3 col-sm-offset-5">
        <div class="row">
            <div class="text-right">
                2016/04/01 12:34:56
            </div>
        </div>
        <div class="row">
            <div class="text-right">
                <button type="submit" class="btn btn-primary">画面<br>切替</button>
            </div>
        </div>
    </div>
</div>

<div class="row col-sm-12">
    <div class="col-sm-3 col-sm-offset-1 text-center bg-danger operating-state-nm">
        <label th:text="${reception.workingReception.receptionState}" style="margin-top: 10px;">対応中</label>
    </div>
    <div class="col-sm-3 text-center bg-info operating-no">
        <label th:text="${reception.workingReception.displayId}" style="margin-top: 10px;">001</label>
    </div>
    <div class="col-sm-4" style="margin-top: 20px;">
        <form th:action="@{/reception/start}"
              th:object="${reception.workingReception}"
              class="form-horizontal" method="post">
            <input type="hidden" name="displayId" th:value="${displayId}"/>
            <button type="submit" class="btn btn-warning btn-lg">業務開始</button>
            <input type="hidden" name="displayId" th:value="${displayId}"/>
            <button type="submit" class="btn btn-warning btn-lg">業務終了</button>
        </form>
    </div>
</div>

<div class="row col-sm-12" style="margin-top: 50px; margin-left: 5px;">
    <div id="waiting-carousel" class="carousel slide" data-ride="carousel" data-interval="false">
        <div class="col-sm-offset-1 carousel-inner" style="margin-left: 80px;">
            <div class="item active">
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>001</button>
                </div>
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>002</button>
                </div>
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>003</button>
                </div>
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>004</button>
                </div>
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>005</button>
                </div>
            </div>
            <div class="item">
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>006</button>
                </div>
                <div class="col-sm-2 text-center">
                    <button th:text="${reception.displayId}"
                            class='btn-receiving-no btn-lg btn-primary data-toggle="button" aria-pressed="false" autocomplete="off"'>007</button>
                </div>
            </div>
        </div>
        <a class="left carousel-control" href="#waiting-carousel" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#waiting-carousel" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
</div>

<div class="row col-sm-12" style="margin-top: 50px;">
    <div class="col-sm-offset-1">
        <button type="submit" class="btn btn-primary btn-lg">呼出</button>
        <button type="submit" class="btn btn-primary btn-lg">呼出取消</button>
        <button type="submit" class="btn btn-primary btn-lg">一時保留</button>
        <button type="submit" class="btn btn-primary btn-lg">業務取消</button>
        <button type="submit" class="btn btn-primary btn-lg">業務移動</button>
    </div>
</div>
<div class="row col-sm-12" style="margin-top: 50px;">
    <div class="col-sm-4 col-sm-offset-7 text-right ">
        <label class="rest-no-nm">残り人数</label>
        <label th:text="${reception.restNum}" class="rest-no-nm">12</label>
    </div>
</div>

<script th:src="@{/js/lib/stomp.js}"></script>
<script th:src="@{/js/stompUtil.js}"></script>
<script type="text/javascript">
    $(window).load(function () {
        var sendedId;
        var reloadPage = function (msg) {
            var dto = JSON.parse(msg.body);
            console.log(dto);
            if (dto.displayId == sendedId) {
                alert(dto.displayId + "を呼び出しました。");
            }
            stompUtil.disconnect();
            location.href = "/pepper/reception";
        };
        // websocketで状態変化を受信したらリロード
        StompUtil.prototype.onSubscribeStateChanged = reloadPage;
        var stompUtil = new StompUtil();
        stompUtil.sendChangeState.bind(stompUtil);
        stompUtil.connect.bind(stompUtil);
        var callSelectedNo = function (evt) {
            var displayId = $(evt.target).attr("data");
            sendedId = displayId;
            stompUtil.sendChangeState(
                    JSON.stringify(
                            {
                                "displayId": displayId,
                                "statusCd": "1"
                            })
            );
        }
        $('.callBtn').on('click', callSelectedNo);
        stompUtil.connect();
    });
</script>
</div>
</body>
</html>
